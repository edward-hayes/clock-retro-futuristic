"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const stream_1 = require("stream");
const cbor = require("cbor");
const decoders = {
    'cbor-definite': cbor.decode,
    json: JSON.parse,
};
class ConfigurableDecode extends stream_1.Transform {
    constructor(decoder = 'json') {
        super({ readableObjectMode: true });
        this.decoder = decoder;
    }
    canAcceptRawBuffers() {
        return this.decoder === 'cbor-definite';
    }
    setDecoder(encoder) {
        this.decoder = encoder;
    }
    _transform(chunk, encoding, callback) {
        let decodedChunk;
        try {
            decodedChunk = decoders[this.decoder](chunk);
        }
        catch (e) {
            callback(e);
            return;
        }
        callback(undefined, decodedChunk);
    }
}
exports.default = ConfigurableDecode;
//# sourceMappingURL=ConfigurableDecode.js.map